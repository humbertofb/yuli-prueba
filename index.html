<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de preguntas y respuestas</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<header>
<h2>Preguntas y respuestas</h2>
<button id="menuButton">☰</button>
</header>
<nav id="menu">
<ul>
<li><a href="index.html">Inicio</a></li>
<li><a href="videos.html">Videos</a></li>
<li><a href="viajes.html">Viajes</a></li>
<li><a href="login.html"></a></li>
<li><a href="arbol de metas.html">Árbol de metas</a></li>
<li><a href="frases.html">Frases</a></li>
<li><a href="reencuentro.html">Reencuentro</a></li>
</ul>
</nav>
<main>
<h1>Juego de Preguntas y Respuestas</h1>
<form id="questionForm">
<input type="text" id="name" placeholder="Escribe tu nombre" required>
<textarea id="question" placeholder="Escribe tu pregunta" required></textarea>
<button type="submit">Enviar</button>
</form>
<div class="forms-container">
<!-- Repetir el formulario cinco veces -->
<div id="questionsContainer0" class="styled-container"></div>
<div id="questionsContainer1" class="styled-container"></div>
<div id="questionsContainer2" class="styled-container"></div>
<div id="questionsContainer3" class="styled-container"></div>
<div id="questionsContainer4" class="styled-container"></div>
</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', async function() {
if (typeof supabase === 'undefined' || typeof supabase.createClient === 'undefined') {
console.error('Error: La biblioteca de Supabase no se ha cargado correctamente.');
return;
}

const supabaseUrl = 'https://bfjimcvsknmxaanhmayc.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmamltY3Zza25teGFhbmhtYXljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUxNDIyMzcsImV4cCI6MjA0MDcxODIzN30.jVrklsT3FHaq8Hxzmg6GXlE6dp14ELqHCG7NjOA7muI';

let supabaseClient;

try {
supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
} catch (error) {
console.error('Error al inicializar Supabase:', error);
return;
}

async function initializeForm(formIndex) {
try {
const { data: questions, error } = await supabaseClient
.from(`question${formIndex}`)
.select('*');

if (error) throw error;

const questionsContainer = document.getElementById(`questionsContainer${formIndex}`);
questionsContainer.innerHTML = '';
questions.forEach((question) => {
const div = document.createElement('div');
div.className = 'question';
div.innerHTML = `
<p><strong>${question.name}</strong>: <span class="question-text" contenteditable="false">${question.question}</span></p>
${question.answer ? `<p><strong>Respuesta:</strong> <span class="answer-text" contenteditable="false">${question.answer}</span></p>` : ''}
<div class="question-buttons">
<button onclick="deleteQuestion(${formIndex}, ${question.id})">Eliminar</button>
<button onclick="editQuestion(${formIndex}, ${question.id}, 'question')">Editar Pregunta</button>
${question.answer ? `<button onclick="editQuestion(${formIndex}, ${question.id}, 'answer')">Editar Respuesta</button>` : ''}
<button id="responder" onclick="showAnswerInput(${formIndex}, ${question.id})">
<i class="fa fa-reply"></i> Responder
</button>
</div>
<div id="answerInput${formIndex}-${question.id}" class="answer-input" style="display: none;">
<textarea id="answer${formIndex}-${question.id}" placeholder="Escribe tu respuesta"></textarea>
<button onclick="submitAnswer(${formIndex}, ${question.id})">Enviar Respuesta</button>
</div>
`;
questionsContainer.appendChild(div);
});
} catch (error) {
console.error('Error al inicializar el formulario:', error);
}
}

document.getElementById('questionForm').addEventListener('submit', async function(e) {
e.preventDefault();
const name = document.getElementById('name').value;
const question = document.getElementById('question').value;

try {
const { error } = await supabaseClient
.from('question0')  // Cambia esto si quieres insertar en una tabla específica
.insert([{ name, question }]);

if (error) throw error;

document.getElementById('name').value = '';
document.getElementById('question').value = '';
initializeForm(0);  // Inicializa el primer formulario después de insertar
} catch (error) {
console.error('Error al enviar la pregunta:', error);
}
});

for (let i = 0; i < 5; i++) {
initializeForm(i);
}

window.deleteQuestion = async function(formIndex, id) {
try {
const { error } = await supabaseClient
.from(`question${formIndex}`)
.delete()
.eq('id', id);

if (error) throw error;

initializeForm(formIndex);
} catch (error) {
console.error('Error al eliminar la pregunta:', error);
}
};

window.editQuestion = function(formIndex, id, type) {
const questionText = document.querySelector(`#questionsContainer${formIndex} .question-text`);
const answerText = document.querySelector(`#questionsContainer${formIndex} .answer-text`);

if (type === 'question') {
questionText.contentEditable = true;
questionText.focus();
} else if (type === 'answer') {
answerText.contentEditable = true;
answerText.focus();
}

questionText.addEventListener('blur', async function() {
const newValue = questionText.innerText;
try {
const { error } = await supabaseClient
.from(`question${formIndex}`)
.update({ question: newValue })
.eq('id', id);

if (error) throw error;

questionText.contentEditable = false;
initializeForm(formIndex);
} catch (error) {
console.error(`Error al editar ${type}:`, error);
}
});

answerText.addEventListener('blur', async function() {
const newValue = answerText.innerText;
try {
const { error } = await supabaseClient
.from(`question${formIndex}`)
.update({ answer: newValue })
.eq('id', id);

if (error) throw error;

answerText.contentEditable = false;
initializeForm(formIndex);
} catch (error) {
console.error(`Error al editar ${type}:`, error);
}
});
};

window.showAnswerInput = function(formIndex, id) {
document.getElementById(`answerInput${formIndex}-${id}`).style.display = 'block';
};

window.submitAnswer = async function(formIndex, id) {
const answer = document.getElementById(`answer${formIndex}-${id}`).value;
if (answer) {
try {
const { error } = await supabaseClient
.from(`question${formIndex}`)
.update({ answer })
.eq('id', id);

if (error) throw error;

document.getElementById(`answerInput${formIndex}-${id}`).style.display = 'none';
initializeForm(formIndex);
} catch (error) {
console.error('Error al enviar la respuesta:', error);
}
}
};
});
</script>
</body>
</html>
