<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de preguntas y respuestas</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<header>
<h2>Preguntas y respuestas</h2>
<button id="menuButton">☰</button>
</header>
<nav id="menu">
<ul>
<li><a href="index.html">Inicio</a></li>
<li><a href="videos.html">Videos</a></li>
<li><a href="viajes.html">Viajes</a></li>
<li><a href="login.html"></a></li>
<li><a href="arbol de metas.html">Árbol de metas</a></li>
<li><a href="frases.html">Frases</a></li>
<li><a href="reencuentro.html">Reencuentro</a></li>
</ul>
</nav>
<main>
<h1>Juego de Preguntas y Respuestas</h1>
<form id="questionForm">
<input type="text" id="name" placeholder="Escribe tu nombre" required>
<textarea id="question" placeholder="Escribe tu pregunta" required></textarea>
<button type="submit">Enviar</button>
</form>
<div class="forms-container">
<div id="questionsContainer" class="styled-container"></div>
</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', async function() {
if (typeof supabase === 'undefined' || typeof supabase.createClient === 'undefined') {
console.error('Error: La biblioteca de Supabase no se ha cargado correctamente.');
return;
}

const supabaseUrl = 'https://bfjimcvsknmxaanhmayc.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmamltY3Zza25teGFhbmhtYXljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUxNDIyMzcsImV4cCI6MjA0MDcxODIzN30.jVrklsT3FHaq8Hxzmg6GXlE6dp14ELqHCG7NjOA7muI';

let supabaseClient;

try {
supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
} catch (error) {
console.error('Error al inicializar Supabase:', error);
return;
}

async function initializeForm() {
try {
const { data: questions, error } = await supabaseClient
.from('questions')
.select('*');

if (error) throw error;

const questionsContainer = document.getElementById('questionsContainer');
questionsContainer.innerHTML = '';
questions.forEach((question) => {
const div = document.createElement('div');
div.className = 'question';
div.innerHTML = `
<p><strong>${question.name}</strong>: ${question.question}</p>
${question.answer ? `<p><strong>Respuesta:</strong> ${question.answer}</p>` : ''}
<div class="question-buttons">
<button onclick="deleteQuestion(${question.id})">Eliminar</button>
<button onclick="editQuestion(${question.id}, 'question')">Editar Pregunta</button>
${question.answer ? `<button onclick="editQuestion(${question.id}, 'answer')">Editar Respuesta</button>` : ''}
<button id="responder" onclick="showAnswerInput(${question.id})">
<i class="fa fa-reply"></i> Responder
</button>
</div>
<div id="answerInput${question.id}" class="answer-input" style="display: none;">
<textarea id="answer${question.id}" placeholder="Escribe tu respuesta"></textarea>
<button onclick="submitAnswer(${question.id})">Enviar Respuesta</button>
</div>
`;
questionsContainer.appendChild(div);
});
} catch (error) {
console.error('Error al inicializar el formulario:', error);
}
}

document.getElementById('questionForm').addEventListener('submit', async function(e) {
e.preventDefault();
const name = document.getElementById('name').value;
const question = document.getElementById('question').value;

try {
const { error } = await supabaseClient
.from('questions')
.insert([{ name, question }]);

if (error) throw error;

document.getElementById('name').value = '';
document.getElementById('question').value = '';
initializeForm();
} catch (error) {
console.error('Error al enviar la pregunta:', error);
}
});

initializeForm();

window.deleteQuestion = async function(id) {
try {
const { error } = await supabaseClient
.from('questions')
.delete()
.eq('id', id);

if (error) throw error;

initializeForm();
} catch (error) {
console.error('Error al eliminar la pregunta:', error);
}
};

window.editQuestion = async function(id, type) {
const newValue = prompt(`Edita tu ${type}:`);
if (newValue) {
try {
const { error } = await supabaseClient
.from('questions')
.update({ [type]: newValue })
.eq('id', id);

if (error) throw error;

initializeForm();
} catch (error) {
console.error(`Error al editar ${type}:`, error);
}
}
};

window.showAnswerInput = function(id) {
document.getElementById(`answerInput${id}`).style.display = 'block';
};

window.submitAnswer = async function(id) {
const answer = document.getElementById(`answer${id}`).value;
if (answer) {
try {
const { error } = await supabaseClient
.from('questions')
.update({ answer })
.eq('id', id);

if (error) throw error;

document.getElementById(`answerInput${id}`).style.display = 'none';
initializeForm();
} catch (error) {
console.error('Error al enviar la respuesta:', error);
}
}
};
});
</script>
</body>
</html>
